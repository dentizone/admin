<app-toast-component
  *ngIf="viewToast"
  [isSuccess]="isToastSuccess"
  [message]="toastMessage"
></app-toast-component>

<h1 class="text-2xl font-bold mb-1">Withdrawal Management</h1>
<h6 class="mb-6 text-gray-500">
  Overview of Withdrawal Requests in Dentizone.
</h6>

<!-- Stats Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mb-6">
  <div class="bg-white shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Total</span>
    <span class="text-2xl font-bold text-blue-600">{{ stats.total }}</span>
  </div>
  <div class="bg-yellow-50 shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Pending</span>
    <span class="text-2xl font-bold text-yellow-600">{{ stats.pending }}</span>
  </div>
  <div class="bg-green-50 shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Approved</span>
    <span class="text-2xl font-bold text-green-600">{{ stats.approved }}</span>
  </div>
  <div class="bg-red-50 shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Rejected</span>
    <span class="text-2xl font-bold text-red-600">{{ stats.rejected }}</span>
  </div>
  <div class="bg-indigo-50 shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Completed</span>
    <span class="text-2xl font-bold text-indigo-600"
      >{{ stats.completed }}</span
    >
  </div>
  <div class="bg-gray-100 shadow rounded-lg p-4 flex flex-col items-center">
    <span class="text-lg font-semibold">Failed</span>
    <span class="text-2xl font-bold text-gray-600">{{ stats.failed }}</span>
  </div>
</div>

<!-- Filters -->
<div class="flex flex-col md:flex-row md:items-end gap-4 mb-6">
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
    <select
      class="border rounded px-3 py-2 w-full"
      [(ngModel)]="filter.status"
      (change)="onFilterChange()"
    >
      <option value="">All</option>
      <option value="Pending">Pending</option>
      <option value="Approved">Approved</option>
      <option value="Rejected">Rejected</option>
      <option value="Completed">Completed</option>
    </select>
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Search</label>
    <input
      class="border rounded px-3 py-2 w-full"
      type="text"
      placeholder="Search by user..."
      [(ngModel)]="filter.searchTerm"
      (input)="onFilterChange()"
    />
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
    <input
      class="border rounded px-3 py-2 w-full"
      type="date"
      [(ngModel)]="filter.date"
      (change)="onFilterChange()"
    />
  </div>
</div>

<!-- Table -->
<div class="relative overflow-x-auto shadow-md sm:rounded-lg bg-white">
  <table class="w-full text-sm text-left text-gray-500">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
      <tr>
        <th class="px-6 py-3">User Name</th>
        <th class="px-6 py-3">Amount</th>
        <th class="px-6 py-3">Date</th>
        <th class="px-6 py-3">Status</th>
        <th class="px-6 py-3">Action</th>
      </tr>
    </thead>
    <tbody>
      <tr
        *ngFor="let req of requests"
        class="bg-white border-b hover:bg-gray-50"
      >
        <td class="px-6 py-4 font-medium text-gray-900">{{ req.fullName }}</td>
        <td class="px-6 py-4">{{ req.amount | number:'1.2-2' }}</td>
        <td class="px-6 py-4">{{ req.createdAt | date:'mediumDate' }}</td>
        <td class="px-6 py-4">
          <span
            [ngClass]="{
            'text-yellow-600': req.status === 'Pending',
            'text-green-600': req.status === 'Approved',
            'text-red-600': req.status === 'Rejected',
            'text-indigo-600': req.status === 'Completed'
          }"
            class="font-semibold"
            >{{ req.status }}</span
          >
        </td>
        <td class="px-6 py-4 space-x-2">
          <button
            *ngIf="req.status === 'Pending'"
            class="bg-red-500 px-4 py-1 rounded-md text-white font-semibold"
          >
            Denied
          </button>
          <button
            *ngIf="req.status === 'Pending'"
            class="bg-green-500 px-4 py-1 rounded-md text-white font-semibold"
          >
            Accept
          </button>
        </td>
      </tr>
      <tr *ngIf="!loading && requests.length === 0">
        <td colspan="5" class="text-center py-6 text-gray-400">
          No withdrawal requests found.
        </td>
      </tr>
      <tr *ngIf="loading">
        <td colspan="5" class="text-center py-6 text-gray-400">Loading...</td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Pagination -->
<div class="flex justify-between items-center mt-6" *ngIf="totalPages > 1">
  <button
    class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300"
    [disabled]="filter.page === 1"
    (click)="onPageChange(filter.page - 1)"
  >
    Previous
  </button>
  <div class="space-x-1">
    <button
      *ngFor="let page of [].constructor(totalPages); let i = index"
      class="px-3 py-1 rounded"
      [ngClass]="filter.page === (i+1) ? 'bg-blue-500 text-white' : 'bg-gray-200 hover:bg-gray-300'"
      (click)="onPageChange(i+1)"
    >
      {{ i+1 }}
    </button>
  </div>
  <button
    class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300"
    [disabled]="filter.page === totalPages"
    (click)="onPageChange(filter.page + 1)"
  >
    Next
  </button>
</div>
