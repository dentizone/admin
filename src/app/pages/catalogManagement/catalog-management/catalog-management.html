<app-toast-component *ngIf="viewToast" [isSuccess]="isToastSuccess" [message]="toastMessage"></app-toast-component>
<div class="flex justify-between">
    <h1 class="text-2xl font-bold ">
        Catalog Management
    </h1>
    <button class="bg-[#2596be] hover:bg-[#25b3e7] text-white rounded-md py-2 px-4" (click)="handelAddCategory()">Add new Category</button>


</div>
<h6 class="mb-4 text-gray-500">This is overview about All Categories in Dentizone.</h6>

<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
    <div class="flex gap-3">
    <!-- Categories Table -->
<div class="w-5/6 md:w-2/3 overflow-auto">
  <table class="w-full text-sm text-left text-gray-500">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3">Category Name</th>
        <th scope="col" class="px-6 py-3">Action</th>
      </tr>
    </thead>
    <tbody>
      @for (catalog of categories; track $index) {
      <tr onkeydown="" (click)="getSubcategory(catalog.id,$index)" class="bg-white border-b hover:bg-gray-50">
        <td class="flex items-center px-6 py-4 text-gray-900 whitespace-nowrap">
          <img class="w-10 h-10 rounded-md" [src]="catalog.iconUrl" alt="icon">
          <div class="ps-3">
            <div class="text-base font-semibold">{{ catalog.name }}</div>
          </div>
        </td>
        <td class="px-6 py-4 text-red-600">
          <div class="inline-flex space-x-5">
          <a (click)="showEdit($index)" class="font-medium text-blue-600 hover:underline">Edit Category</a>
          <svg onkeydown="" xmlns="http://www.w3.org/2000/svg" (click)="removeCategory(catalog.id)"
     fill="" 
     viewBox="0 0 24 24" 
     stroke-width="1.5" 
     stroke="currentColor" 
     class="w-6 h-6">
  <path stroke-linecap="round" 
        stroke-linejoin="round" 
        d="M6 18L18 6M6 6l12 12" />
</svg>
</div>
        </td>
      </tr>}
    </tbody>
  </table>
</div>

<!-- Subcategory Table -->
<div class="w-full md:w-1/3 overflow-auto max-h-[500px] mt-10 justify-self-center place-items-center">
  <table class="w-5/6 border text-sm text-left text-blue-500">
    <thead class="text-xs text-blue-700 uppercase bg-blue-50">
      <tr>
        <th scope="col" class="px-6 py-3">Subcategory Name
            <span *ngIf="selectedCategory.id" class="float-end"><button (click)="handelSubcategoryadd()">Add New</button></span>
        </th>
      </tr>
    </thead>
    <tbody>
      @if (!subCategory[0]) {
        <tr class="bg-white border-b hover:bg-blue-50">
          <td class="px-6 py-4 text-gray-900 whitespace-nowrap">Choose Category First</td>
        </tr>
      } @else {
        @for (catalog of subCategory; track $index) {
        <tr class="bg-white border-b hover:bg-blue-50">
          <td class="px-6 py-4 text-blue-900 whitespace-nowrap">
            <div class="text-base font-semibold">{{ catalog.name }}
                <svg xmlns="http://www.w3.org/2000/svg" 
                onkeydown=""
                    (click)="removeSubcategory(catalog.id)"
                    fill="none" 
                    viewBox="0 0 24 24" 
                    stroke-width="1.5" 
                    stroke="currentColor" 
                    class="w-6 h-6 float-end">
                    <path stroke-linecap="round" 
                        stroke-linejoin="round" 
                        d="M6 7h12M9 7v10m6-10v10M4 7h16M10 3h4a1 1 0 011 1v1H9V4a1 1 0 011-1z" />
                </svg>
            </div>
            

          </td>
        </tr>}
      }
    </tbody>
  </table>
</div>

    </div>
    <!-- Edit user modal -->
    <div onkeydown="" *ngIf="isEditShown" class="fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto bg-black/30"(click)="onBackdropClick($event)">
  <div onkeydown="" class="relative w-full max-w-2xl max-h-full" (click)="$event.stopPropagation()">
    
    <!-- Modal content -->
    <form class="relative bg-white rounded-lg shadow-md">
      <!-- Modal header -->
      <div class="flex items-start justify-between p-4 border-b rounded-t border-gray-200">
        <h3 class="text-xl font-semibold text-gray-900">Edit Catalog</h3>
        <button (click)="showEdit()" type="button"
                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center">
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>

      <!-- Modal body -->
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-6 gap-6">
            <div class="col-span-3">
                <div class="relative h-32">
                        <img [src]="selectedCategory.iconUrl" alt="Category icon"
                            class="w-full h-full object-contain rounded-lg border border-gray-300" />

                        <!-- Edit Icon (click to trigger file input) -->
                        <label class="absolute top-1 right-1 bg-white rounded-full p-1 shadow cursor-pointer hover:bg-gray-100">
                            <input type="file" hidden accept="image/*" (change)="onImageChange($event)" />
                            <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 13.586V16h2.414l7.293-7.293-2.414-2.414L4 13.586zM17.707 6.293a1 1 0 0 0 0-1.414l-2.586-2.586a1 1 0 0 0-1.414 0l-1.293 1.293 3.999 3.999 1.294-1.292z"/>
                            </svg>
                        </label>
                    </div>
            </div>
            <div class="col-start-6 sm:col-span-3">
                <label for="Subcategory-name" class="block mb-2 text-sm font-medium text-gray-900 ">Category Name</label>
                <input [(ngModel)]="newCategoryName"
                [ngModelOptions]="{standalone:true}"
                type="text" name="Subcategory-name" id="Subcategory-name" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 " placeholder="Enter The Subcategory Name" required>
            </div>
        </div>
      </div>

      <!-- Modal footer -->
      <div class="flex items-center p-6 space-x-3 rtl:space-x-reverse border-t border-gray-200 rounded-b">
        <button type="submit"
        (click)="UpdateCategory(selectedCategory.id)"
                class="text-white bg-[#2596be] hover:bg-[#20aadc] focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
          Update Category
        </button>
      </div>
    </form>
  </div>
</div>

<!--  -->
 <div onkeydown="" *ngIf="isAddCategoryShow" class="fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto bg-black/30"(click)="onBackdropClick($event)">
  <div onkeydown="" class="relative w-full max-w-2xl max-h-full" (click)="$event.stopPropagation()">
    
    <!-- Modal content -->
    <form class="relative bg-white rounded-lg shadow-md">
      <!-- Modal header -->
      <div class="flex items-start justify-between p-4 border-b rounded-t border-gray-200">
        <h3 class="text-xl font-semibold text-gray-900">Add New Catalog</h3>
        <button (click)="handelAddCategory()" type="button"
                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center">
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>

      <!-- Modal body -->
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-6 gap-6">
            <div class="col-span-3">
                <div class="relative h-32">
                        <img [src]="newCategory.iconUrl" alt="Category icon"
                            class="w-full h-full object-contain rounded-lg border border-gray-300" />

                        <!-- Edit Icon (click to trigger file input) -->
                        <label class="absolute top-1 right-1 bg-white rounded-full p-1 shadow cursor-pointer hover:bg-gray-100">
                            <input type="file" hidden accept="image/*" (change)="onImageUpload($event)" />
                            <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 13.586V16h2.414l7.293-7.293-2.414-2.414L4 13.586zM17.707 6.293a1 1 0 0 0 0-1.414l-2.586-2.586a1 1 0 0 0-1.414 0l-1.293 1.293 3.999 3.999 1.294-1.292z"/>
                            </svg>
                        </label>
                    </div>
            </div>
            <div class="col-start-6 sm:col-span-3">
                <label for="Subcategory-name" class="block mb-2 text-sm font-medium text-gray-900 ">Category Name</label>
                <input [(ngModel)]="newCategory.name"
                [ngModelOptions]="{standalone:true}"
                type="text" name="Subcategory-name" id="Subcategory-name" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 " placeholder="Enter The Subcategory Name" required>
            </div>
        </div>
      </div>

      <!-- Modal footer -->
      <div class="flex items-center p-6 space-x-3 rtl:space-x-reverse border-t border-gray-200 rounded-b">
        <button type="submit"
        (click)="addCategory()"
                class="text-white bg-[#2596be] hover:bg-[#20aadc] focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
          Add New Category
        </button>
      </div>
    </form>
  </div>
</div>




<div *ngIf="subCategoryAddShow" class="fixed inset-0 z-50 flex items-center justify-center w-full p-4 overflow-x-hidden overflow-y-auto bg-black/30"
(click)="onBackdropClick($event)"
onkeydown=""
>
  <div onkeydown="" class="relative w-full max-w-2xl max-h-full" (click)="$event.stopPropagation()">
    <!-- Modal content -->
    <form class="relative bg-white rounded-lg shadow-md">
      <!-- Modal header -->
      <div class="flex items-start justify-between p-4 border-b rounded-t border-gray-200">
        <h3 class="text-xl font-semibold text-gray-900">Add Subcategory to <span class="text-[#0f7297]">{{selectedCategory.name}}</span></h3>
        <button (click)="handelSubcategoryadd()" type="button"
                class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center">
          <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 14 14">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
          </svg>
          <span class="sr-only">Close modal</span>
        </button>
      </div>

      <!-- Modal body -->
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-6 gap-6">
           <div class="col-span-6 sm:col-span-3">
                <label for="Subcategory-name" class="block mb-2 text-sm font-medium text-gray-900 ">Subcategory Name</label>
                <input [(ngModel)]="newSubCategoryName"
                [ngModelOptions]="{standalone:true}"
                type="text" name="Subcategory-name" id="Subcategory-name" class="shadow-xs bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-600 focus:border-blue-600 block w-full p-2.5 " placeholder="Enter The Subcategory Name" required="">
            </div>
            <button type="submit"
            (click)="addSubCategory()"
                class="text-white col-span-3 float-end h-3/4 mt-5 justify-self-center bg-[#2596be] hover:bg-[#24b2e6] focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center">
          ADD
        </button>
        </div>
      </div>
    </form>
  </div>
</div>
