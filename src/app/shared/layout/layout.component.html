<!-- Main Layout Container -->
<div class="flex relative h-screen bg-gray-50">
  <!-- Mobile Menu Button -->
  <button
    (click)="toggleSidebar()"
    class="fixed top-4 left-4 z-20 p-2 bg-white rounded-md shadow-lg lg:hidden"
  >
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      @if (!isSidebarOpen()) {
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16M4 12h16M4 18h16"
      />
      } @else {
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M6 18L18 6M6 6l12 12"
      />
      }
    </svg>
  </button>

  <!-- Sidebar -->
  <aside
    [class.translate-x-0]="isSidebarOpen()"
    [class.-translate-x-full]="!isSidebarOpen()"
    class="fixed inset-y-0 left-0 z-10 w-64 bg-white shadow-lg transition duration-200 ease-in-out transform lg:translate-x-0 lg:static"
  >
    <div class="px-6 py-4 border-b">
      <div
        routerLink="/dashboard"
        class="flex gap-2 items-center cursor-pointer"
      >
        <img
          class="w-24"
          src="/assets/images/LogoWithoutBackground.png"
          alt=""
        />
      </div>
    </div>

    <nav class="px-4 py-4 overflow-y-auto h-[calc(100vh-4rem)]">
      <!-- Main Menu -->
      <div class="space-y-1">
        @for (item of sidebarItems; track item.route) {
        <a
          [routerLink]="item.route"
          (click)="setActiveItem(item)"
          [class.bg-blue-50]="item.active"
          [class.text-blue-600]="item.active"
          class="flex gap-3 items-center px-3 py-2 text-gray-700 rounded-lg transition-colors hover:bg-gray-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            @switch (item.icon) { @case ('squares-2x2') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
            />
            } @case ('users') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
            />
            } @case ('bolt') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14 3L5 16h7l-1 5 9-13h-7l1-5z"
            />
            } @case ('document-text') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            />
            } @case ('book-open') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            />
            } @case ('academic-cap') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 14l9-5-9-5-9 5 9 5z M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"
            />
            } @case ('shopping-bag') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.993 1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 0 1-1.12-1.243l1.264-12A1.125 1.125 0 0 1 5.513 7.5h12.974c.576 0 1.059.435 1.119 1.007ZM8.625 10.5a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm7.5 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"
            />
            } @case ("review-icon") {

            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              strokeWidth="{1.5}"
              stroke="currentColor"
              className="size-6"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"
              />
            </svg>

            } }
          </svg>
          <span>{{ item.label }}</span>
        </a>
        } @for (item of financialItems; track item.route) {
        <a
          [routerLink]="item.route"
          (click)="setActiveItem(item)"
          [class.bg-blue-50]="item.active"
          [class.text-blue-600]="item.active"
          class="flex gap-3 items-center px-3 py-2 text-gray-700 rounded-lg transition-colors hover:bg-gray-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            @if (item.icon === 'credit-card') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
            />
            } @else if (item.icon === 'currency-dollar') {
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
            }
          </svg>
          <span>{{ item.label }}</span>
        </a>
        }
      </div>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="flex overflow-hidden flex-col flex-1 lg:pl-0">
    <!-- Top Header -->
    <header class="flex items-center px-6 h-16 bg-white border-b shadow-sm">
      <!-- User Menu -->
      <div class="flex gap-3 items-center ml-auto">
        <div
          class="flex justify-center items-center w-8 h-8 text-sm font-medium text-white bg-blue-600 rounded-full"
        >
          {{ user?.fullName ? (user.fullName[0] + (user.fullName.split(' ')[1]?.[0] || '')) : 'AU' }}
        </div>
        <div class="flex flex-col">
          <span class="text-sm font-medium">{{
            user?.fullName || "Admin User"
          }}</span>
          <span class="hidden text-xs text-gray-500 sm:inline">{{
            user?.email || "Super Admin"
          }}</span>
        </div>
        <button
          *ngIf="!loadingUser && user"
          (click)="logout()"
          class="px-3 py-1 ml-4 text-white bg-[#e82e2e] rounded hover:bg-red-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
            <polyline points="16 17 21 12 16 7" />
            <line x1="21" y1="12" x2="9" y2="12" />
          </svg>
        </button>
        <span *ngIf="loadingUser" class="flex items-center ml-4"
          ><span class="mr-2 loader"></span> Loading user...</span
        >
      </div>
    </header>

    <!-- Main Content Area -->
    <main
      class="overflow-y-auto overflow-x-hidden flex-1 p-4 bg-gray-50 md:p-6"
    >
      <router-outlet />
    </main>
  </div>

  <!-- Overlay for mobile sidebar -->
  @if (isSidebarOpen()) {
  <button
    (click)="toggleSidebar()"
    (keydown.escape)="toggleSidebar()"
    aria-label="Close sidebar"
    class="fixed inset-0 z-0 bg-black bg-opacity-50 border-0 lg:hidden"
  ></button>
  }

  <!-- Global Loading Overlay -->
  <div
    *ngIf="globalLoading"
    class="flex fixed inset-0 z-50 justify-center items-center bg-black bg-opacity-30"
  >
    <span class="loader"></span>
  </div>
</div>
